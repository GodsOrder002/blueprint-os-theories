-- auto-generated definition
create table constraint_cases
(
    id              bigint unsigned auto_increment
        primary key,

    constraint_id   bigint unsigned default '0'               not null comment '对应 constraints.id（不设外键）',

    case_type_id    bigint          default 0                 not null comment '案例类型：type_dict(name=case_type).id，例如 positive/negative/contrast',
    status_id       bigint          default 0                 not null comment '状态：你定义，例如 0=unreview,1=active,-1=deprecated',

    title           varchar(64)     default ''                not null comment '案例标题/一句话摘要',
    context         varchar(255)    default ''                not null comment '场景上下文（简短）',

    input_text      longtext                                  not null comment '原始表达/输入（默认空串）',
    output_text     longtext                                  not null comment '优化后/命中后表达（默认空串）',

    misread_text    longtext                                  not null comment '可能的误解版本（默认空串）',
    `explain`         text                                      not null comment '要点解释（默认空串）',

    hash            char(40)        default ''                not null comment '去重用hash（可选，存sha1/自定义）',

    created_at      timestamp       default CURRENT_TIMESTAMP not null,
    updated_at      timestamp       default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP
)
    comment '约束条件的具体案例库（命中/反例；不允许NULL；不设外键）';

create index idx_constraint_status
    on constraint_cases (constraint_id, status_id);

create index idx_case_type_status
    on constraint_cases (case_type_id, status_id);

create unique index uk_hash
    on constraint_cases (hash);
