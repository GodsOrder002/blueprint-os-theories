-- auto-generated definition
create table constraints
(
    id               bigint unsigned auto_increment
        primary key,
    master_id        bigint unsigned default '0'               not null comment '0=主约束；>0=父约束id',
    language_type_id bigint          default 0                 not null comment '语言的类型，英语/德语，等等',
    system_type_id   bigint          default 0                 not null comment '文字系统类型：引用 type_dict.id（name=system_type）',
    description      text                                      not null comment '描述（默认空串）',
    created_at       timestamp       default CURRENT_TIMESTAMP not null,
    updated_at       timestamp       default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP,
    status_id        bigint          default 0                 not null comment '状态：你定义，例如 0=unreview,1=active,0=inactive,-1=deprecated',
    script           longtext                                  not null comment '具体约束条件脚本/规则文本',
    channel_type_id  bigint          default 0                 not null comment '约束条件的类别，书写系统/音律等等'
)
    comment '主子约束条件（单表；不允许NULL；主约束master_id=0）';

create index idx_status_language
    on constraints (status_id, language_type_id);

-- auto-generated definition
create table type_dict
(
    id          bigint auto_increment
        primary key,
    name        varchar(32)  default ''                not null comment '主约束的名字',
    script      varchar(32)  default ''                not null comment '这个约束下的子约束',
    `explain`   varchar(64)  default ''                not null comment '子约束对应的中文解释',
    description varchar(255) default ''                not null,
    status      tinyint      default 1                 not null comment '这条数据的状态',
    created_at  timestamp    default CURRENT_TIMESTAMP not null,
    updated_at  timestamp    default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP,
    constraint uk_group_key
        unique (name, script)
)
    collate = utf8mb4_unicode_ci;

create index idx_group_enabled
    on type_dict (name, status);

